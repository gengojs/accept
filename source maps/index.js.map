{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @author Takeshi Iwana aka iwatakeshi\n * @license MIT 2015\n * gengojs-accept\n * This module parses the accept-language header\n * and returns the approriate locale.\n * Credits to @fundon\n * https://github.com/koa-modules/koa-locale/blob/master/index.js\n */\nimport url from 'url';\nimport cookie from 'cookie';\nimport _ from 'lodash';\n\n/**\n * @class Accept\n */\nclass Accept {\n  /**\n   * Initializes Accept.\n   * @param  {object} req  The request object.\n   * @param  {object} options The options to configure accept.\n   * @return {Accept}     The Accept instance.\n   * @private\n   */\n  constructor(req, options) {\n    this.override = false;\n    //set options\n    this._options(options);\n    if (req)\n      this.set(req);\n    return this;\n  }\n  /** \n   * @private\n   * Sets Accept.\n   * @param {object} req The request object.\n   * @private\n   */\n  set(req) {\n\n    this['accept-language'] = '';\n    // Koa?\n    if (req.request) {\n      this.isKoa = true;\n      this.request = req.request;\n      this.headers = this.request.header;\n      this.cookie = this.headers.cookie || this.headers.cookies;\n    } else if (req.raw) {\n      // Maybe it's hapi\n      this.isHapi = true;\n      this.request = req;\n      this.headers = this.request.headers;\n      this.cookie = this.headers['set-cookie'] || {};\n    } else {\n      // Then it's express\n      this.isKoa = false;\n      this.request = req;\n      this.headers = this.request.headers;\n      this.cookie = this.headers.cookie || this.headers.cookies;\n    }\n    this.detectLocale();\n  }\n  /** \n   * @public\n   * Parses the headers for the Accept-Language.\n   * @param  {object} req The request object.\n   * @return {string|undefined}     The parsed Accept-Language.\n   */\n  getAcceptLanguage(req) {\n    if (req)\n      this['accept-language'] = req.header['accept-language'] ||\n        req.headers['accept-language'] || '';\n    else\n      this['accept-language'] = this.headers['accept-language'];\n    return this['accept-language'] || undefined;\n  }\n  /**\n   * @public\n   * Returns the current locale.\n   * @return {string} The current locale.\n   */\n  getLocale() {\n    return this.locale;\n  }\n  /** \n   * Sets the locale.\n   * @param {string} locale The locale to override the current.\n   * @public\n   */\n  setLocale(locale) {\n    this.override = true;\n    this.locale = this.isSupported(locale);\n    return this.locale;\n  }\n  // From accept-language, `Accept-Language: ja`\n  /**\n   * Parses the Accept-Language.\n   * @param  {object} req      The request object.\n   * @param  {Boolean} fallback Fallback to default.\n   * @return {string|string}          The parsed locale.\n   * @public\n   */\n  getFromHeader(req, fallback) {\n    this.getAcceptLanguage(req);\n    var reg = /(^|,\\s*)([a-z-0-9-]+)/gi,\n      match, result;\n    while ((match = reg.exec(this['accept-language']))) {\n      if (!result)\n        result = match[2];\n    }\n    if (req)\n      return result || undefined; else {\n      this.locale = result = this.isSupported(result);\n      return fallback ? result || undefined : (result || undefined);\n    }\n  }\n  // From query, 'lang=en'\n  /**\n   * Parses the query.\n   * @param  {string} key      The key for the query.\n   * @param  {Boolean} fallback Fallback to default.\n   * @return {string|undefined}          The parsed locale.\n   * @public\n   */\n  getFromQuery(key, fallback) {\n    var result;\n    var query;\n    if (this.isKoa || this.isHapi)\n      query = this.request.query;\n    else\n      query = this.request.query ||\n        url.parse(this.request.url, true).query;\n    this.locale = result = this.isSupported(\n      !_.isEmpty(query) ? query[key] ||\n      query[this.options.keys.query] : undefined);\n    return fallback ? result || undefined : (result || undefined);\n  }\n  // From domain\n  /**\n   * Parses the domain.\n   * @param  {Boolean} fallback Fallback to default.\n   * @return {string|undefined}          The parsed locale.\n   * @public\n   */\n  getFromDomain(fallback) {\n    var result,\n      hostname = this.request.hostname || this.request.info.hostname;\n    result = hostname ? hostname\n      .toString()\n      .toLowerCase()\n      .trim()\n      .split(':')[0].split(/\\./gi)\n      .reverse()[0] : undefined;\n    this.locale = result = this.isSupported(result);\n    return fallback ? result || undefined : (result || undefined);\n  }\n  // From subdomain, 'en.gengojs.com'\n  /**\n   * Parses the subdomain.\n   * @param  {Boolean} fallback Fallback to default.\n   * @return {string|undefined}          The parsed locale.\n   * @public\n   */\n  getFromSubdomain(fallback) {\n    var result;\n    if (this.isKoa)\n      result = this.request.subdomains[0];\n    else\n      result = this.headers.host.split('.')[0];\n    this.locale = result = this.isSupported(result);\n    return fallback ? result || undefined : (result || undefined);\n  }\n  // From cookie, 'lang=ja'\n  /**\n   * Parses the cookie.\n   * @param  {string} key      The key for the cookie.\n   * @param  {Boolean} fallback Fallback to default.\n   * @return {string|undefined}          The parsed locale.\n   * @public\n   */\n  getFromCookie(key, fallback) {\n    var result;\n    result = this.cookie ? cookie.parse(this.cookie)[key] ||\n    cookie.parse(this.cookie)[this.options.keys.cookie] : undefined;\n    this.locale = result = this.isSupported(result);\n    return fallback ? result || undefined : (result || undefined);\n  }\n  // From URL, 'http://gengojs.com/en'\n  /**\n   * Parses the url.\n   * @param  {Boolean} fallback Fallback to default.\n   * @return {string|undefined}          The parsed locale.\n   * @public\n   */\n  getFromUrl(fallback) {\n    var result,\n      path = this.request.path || this.request.url.path;\n    this.locale = result = this.isSupported(\n      path ? path\n        .substring(1)\n        .split('/')\n        .shift() : '');\n    return fallback ? result || undefined : (result || undefined);\n  }\n  // From all, when specified in options\n  /**\n   * Parses the locale by the specified type of parsing.\n   * @param {string} locale The locale to override.\n   * @return {string} The parsed locale.\n   * @public\n   */\n  detectLocale(locale) {\n    _.forEach(this.options.detect, function(value, key) {\n      switch (key) {\n        case 'header':\n          if (value && !this.override)\n            this.locale = this.getFromHeader();\n          break;\n        case 'cookie':\n          if (value && !this.override)\n            this.locale = this.getFromCookie(this.options.keys.cookie);\n          break;\n        case 'url':\n          if (value && !this.override)\n            this.locale = this.getFromUrl();\n          break;\n        case 'domain':\n          if (value && !this.override)\n            this.locale = this.getFromDomain();\n          break;\n        case 'subdomain':\n          if (value && !this.override)\n            this.locale = this.getFromSubdomain();\n          break;\n        case 'query':\n          if (value && !this.override)\n            this.locale = this.getFromQuery(this.options.keys.query);\n          break;\n      }\n    }, this);\n\n    // override?\n    if (locale)\n      this.locale = this.isSupported(locale) || this.locale;\n    // reset the override\n    if (this.override)\n      this.override = false;\n\n    return this.locale;\n  }\n  /**\n   * @private\n   * Sets the options.\n   * @param  {object} options The options.\n   */\n  _options(options) {\n    this.options = _.defaults(options || {}, {\n      check: true,\n      default: 'en-US',\n      supported: [\n        'en-US'\n      ],\n      keys: _.defaults(options ? \n        (options.keys ? options.keys : {}) : {}, {\n        cookie: 'locale',\n        query: 'locale'\n      }),\n      detect: _.defaults(options ? \n        (options.detect ? options.detect : {}) : {}, {\n        header: true,\n        cookie: false,\n        query: false,\n        url: false,\n        domain: false,\n        subdomain: false\n      })\n    });\n  }\n  /**\n   * @public\n   * Checks if the result is supported.\n   * @param  {string} result The locale to check\n   * @return {string}        The locale.\n   * @private\n   */\n  isSupported(result) {\n    if (this.options.check) {\n      var index = this.options.supported.indexOf(result);\n      var locale = this.options.supported[index];\n      locale = locale ? locale : this.options.default;\n      return locale;\n    } else\n      return result;\n  }\n}\n\n/** \n * @export accept\n * The main accept function,\n * @param  {object} req The request object.\n * @param  {object} options The options to configure accept.\n * @return {Accept}     The Accept instance.\n */\nexport default (req, options) => {\n  'use strict';\n  return new Accept(req, options);\n};\n"],"sourceRoot":"/source/"}